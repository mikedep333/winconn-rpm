From 9e1b41538776cf97faa3c227961c9f6de0329302 Mon Sep 17 00:00:00 2001
From: Mike DePaulo <mikedep333@gmail.com>
Date: Sun, 27 Nov 2016 10:12:43 -0500
Subject: [PATCH] Revert "Move to new xfreerdp cli configuration"

This reverts commit 3a6dff883eca34a20d76f82cf4bb87e2d4111a97.
---
 winconn/Commons.py | 30 ++++++++++++++++--------------
 1 file changed, 16 insertions(+), 14 deletions(-)

diff --git a/winconn/Commons.py b/winconn/Commons.py
index 78ea191..ca41176 100644
--- a/winconn/Commons.py
+++ b/winconn/Commons.py
@@ -232,19 +232,19 @@ class Commons:
         return True
     
     def buildCmd(self):
-        cmd = ['xfreerdp', '/cert-ignore']
+        cmd = ['xfreerdp', '--ignore-certificate']
         # compress
         if not self.__odApp__['compress']:
-            cmd.append('/compression')
+            cmd.append('-z')
         # RemoteFX
         if not self.__odApp__['remotefx']:
-            cmd.append('/rfx')
+            cmd.append('--rfx')
 
         # port
         if self.__odApp__['port'] != '3389':
-            cmd.extend('/port:{0}'.format(self.__odApp__['port']))
+            cmd.extend(['-t', self.__odApp__['port']])
         # user
-        cmd.extend(['/u:{0}'.format(self.__odApp__['user'])])
+        cmd.extend(['-u', self.__odApp__['user']])
         # pass
         if self.__odApp__['pass'] == '':
             p = prompts.Prompt('WinConn',_('Enter password for application: ')+self.__odApp__['name'])
@@ -261,28 +261,30 @@ class Commons:
             else:
                 return None
 
-        cmd.extend(['/p:{0}'.format(self.__odApp__['pass'])])
+        cmd.extend(['-p', self.__odApp__['pass']])
         # domain
         if self.__odApp__['domain'] != '':
-            cmd.extend(['/d:{0}'.format(self.__odApp__['domain'])])
+            cmd.extend(['-d', self.__odApp__['domain']])
         # clipboard
         # does not work with freerdp 1.0.1
         if not self.__odApp__['clipboard']:
-            cmd.extend(['+clipboard'])
+            cmd.extend(['--plugin', 'cliprdr'])
         # sound
         if not self.__odApp__['sound']:
-            cmd.extend(['/sound'])
+            cmd.extend(['--plugin', 'rdpsnd'])
         # printer
         if not self.__odApp__['printer']:
-            cmd.extend(['/printer'])
+            cmd.extend(['--plugin', 'rdpdr', '--data', 'printer'])
         # folder
         if self.__odApp__['folder'] != '':
-            cmd.extend(['/drive:winconn:{0}'.format(self.__odApp__['folder'])])
+            cmd.extend(['--plugin', 'rdpdr', '--data', 'disk:winconn:{0}'.format(self.__odApp__['folder'])])
+        # --
+        if not self.__odApp__['printer'] or self.__odApp__['folder'] != '':
+            cmd.append('--')
         # app
-        cmd.extend(['/app:||{0}'.format(self.__odApp__['app'])])
-        # last part without [], you see
+        cmd.extend(['--app', '--plugin', 'rail.so', '--data', self.__odApp__['app'], '--'])
         # server
-        cmd.append('/v:{0}'.format(self.__odApp__['server']))
+        cmd.append(self.__odApp__['server'])
         
         logger.debug(cmd)
 
-- 
2.9.3

